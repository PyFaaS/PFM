# PyFaaS Framework 模型

## 系统组成

PyFaaS 是基于 Python 语言的轻量化 Serverless FaaS 平台，核心特点是基于可插拔的模块化设计思想，可以为使用者提供高度自定义的 FaaS 平台能力。

![](https://www.images.wiki/irxxw4lz8G9asAbCawz5.png)

如上图所示，PyFaaS 系统由网关模块、控制模块以及触发模块、执行模块、存储与可观测模块等组成：

- **网关模块（API Gateway）**：项目整体对外暴露的接入层；
- **控制模块（Controller）**：项目核心业务处理模块，主要包括以下若干子模块：
  - **元信息模块（Meta Module）**：用来管理所有基础信息，包括不限于函数基础信息（函数名、创建时间、内存分配、运行时等）、触发器信息（触发器名称、触发器类型等）等，将与存储模块进行直接交互；
  - **触发器模块（Trigger Module）**：由于 PyFaaS 是 FaaS 项目，所以依旧是由事件触发为核心的项目，此处的触发器是用来接收和处理事件的部分，将与开放生态做深度融合；
  - **任务/请求模块（Task Module）**：用来管理请求和任务的模块；
  - **弹性模块（Scaling Module）**：根据请求等相关数据，进行弹性伸缩决策的模块；
  - **运行时模块（Runtime Plugin）**：用来管理运行时部分；
  - **权限模块（Auth Module）**：包括用户管理与用户权限管理；
- **触发模块（Invoke）**：用来分配任务的模块
  - **同步触发（Sync Invoke）**：经由控制模块将会直接对执行模块进行相关操作，并等待结果返回，并将结果返回到客户端；
  - **异步触发（Async Invoke）**：经由控制模块后，直接将任务 ID 返回客户端，并将任务传递到异步模块（核心实现方案为 Kafka），经消息中间件进行排队处理后，交予执行模块执行，并将结果存储到存储模块；
- **执行模块（Worker Module）**：主要包括调度以及适配两个部分：
  - **调度**：如果执行模块对接了虚机或物理机等，那么执行模块要肩负起调度策略，任务下发到不同机器的方案和策略由当前模块实现；
  - **适配**：所谓适配指的是当执行模块后对接了其他 FaaS 平台（例如阿里云函数计算、华为云函数计算工作流，AWS Lambda等），该模块要做好代码与对应平台的适配逻辑；
- **存储与可观测模块（Storage & Observability）**：主要包括数据库与对象存储等部分以及用户采集、上报和展示相关数据指标；

## 角色与流程

PyFaaS 系统本身包括三个角色：

![](https://www.images.wiki/vAqhrlGzt6S9bwDAEZjd.png)

如上图所示：

1. **PyFaaS 用户**（英文表达：**PyFaaS User** 或 **System Administrator**），指的是 PyFaaS 搭建者。例如，小明通过 PyFaaS 开源项目，自己搭建了私有化 FaaS 平台，那么小明就是所谓的 PyFaaS 用户；
2. **模块开发者**（英文表示：**Module Developer**），指的是模块的开发者。例如，小明发现 PyFaaS 默认的 Scaling 模块算法过于单一，在其私有化的 FaaS 平台中表现并不是非常好，所以小明根据规范，自己开发了一个 Scaling 模块，此时小明就是所谓的 PyFaaS 用户；
3. **普通用户/使用者**（英文表示：**User**），指的是外部用户。例如，小明通过 PyFaaS 开源项目，自己搭建了私有化 FaaS 平台，并在平台中创建了一个 Web 应用，此时小红等人通过互联网访问了该 Web 应用，此时小红就是所谓的普通用户或使用者；

针对这三个角色，所具备的能力，可以用下表表示：

| 角色          | 能力                                                         |
| ------------ | ------------------------------------------------------------ |
| **PyFaaS 用户**  | 创建函数、更新函数、删除函数、查看函数、触发函数<br />查询模块、安装模块、卸载模块<br />配置函数策略、配置弹性策略、配置可观测策略、配置触发器策略、配置权限策略、配置运行时策略 |
| **模块开发者**   | 创建模块、更新模块、删除模块、查询模块                       |
| **普通用户/使用者**| 触发函数                                                     |

### PyFaaS 用户

PyFaaS 是 PyFaaS 系统的建设者和管理员，其拥有对整个私有化系统的全部能力：

![](https://www.images.wiki/t1F6eyxke9hethDxfxdf.png)

如上图所示，当 PyFaaS 用户通过 API 网关模块发起相关操作时，会先有权限模块进行相关的鉴权操作，完成之后，PyFaaS 用户既可以对 PyFaaS 系统进行相对应的配置操作。

除了对系统本身进行管理和配置之外，作为轻量级 FaaS 平台，PyFaaS 用户也将会是函数和触发器等相关资源的创建者，和所有者：

![](https://www.images.wiki/s3hBkyE2981ZC322F92c.png)

1. 用户进行代码的编辑；
2. 将编辑好的代码，通过客户端工具（包括不限于 Web 控制台，命令行工具等）；
3. 通过各类触发器进行函数的调用（当然，如果是公开的 WebAPI 触发器，也可以是外部用户进行函数的调用）；

除了上述能力之外，PyFaaS 用户还可以通过 PyFaaS Module Hub 平台，快速进行模块的搜索、安装、卸载，以进一步扩展 PyFaaS 的能力；如果 PyFaaS 用户具备一定的开发能力，还可以自己根据 PyFaaS Module Model 进行相关 Module 的开发，以获得更为贴合自身的定制化能力：

![](https://www.images.wiki/userpyfaasmodel.png)

通过上图，可以看到，PyFaaS 用户在进行模块的安装使用的时候，往往有以下几条路径：

1. PyFaaS 用户根据需要，自己开发对应的模块，并安装到 PyFaaS 系统中；
2. PyFaaS 用户根据需要，自己开发对应的模块，并发布到 PyFaaS Module Hub 中，分享给更多人使用；
3. PyFaaS 用户在 PyFaaS Module Hub 中搜索合适的模块，并安装到 PyFaaS 系统中；

### 模块开发者



![](https://www.images.wiki/37AyDhGA8FysCcS7dwj9.png)

### 普通用户/使用者

![](https://www.images.wiki/GxGvCAgEy4cfA45u6jGy.png)


## 整体架构

![](https://www.images.wiki/pyfaasframework.png)

## 






在上述模块中，可以进行自定义的主要包括：

| 可自定义逻辑               | 可自定义功能/配置             | 不可自定义               |
|----------------------|-----------------------|---------------------|
| 弹性模块（Scaling Module） | 元信息模块（Meta Module）    | 网关模块（API Gateway）   |
| 执行模块（Worker Module）  | 触发器模块（Trigger Module） | 触发模块（Invoke Module） |
|                      | 运行时模块（Runtime Module） |                     |
|                      | 权限模块（Auth Module）     |                     |
|                      | 任务/请求模块（Task Module）  |                     |

> 关于`可自定义逻辑`，`可自定义功能/配置`与`不可自定义`的解释如下：
>
> - 可自定义逻辑：
> - 可自定义功能/配置：
> - 不可自定义：