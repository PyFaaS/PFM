

## 系统组成

PyFaaS 是基于 Python 语言的轻量化 Serverless FaaS 平台，核心特点是基于可插拔的模块化设计思想，可以为使用者提供高度自定义的 FaaS 平台能力。

![image-20221006213619424](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006213619424.png)

如上图所示，PyFaaS 系统由网关模块、控制模块以及触发模块、执行模块、存储与可观测模块等组成：

- 网关模块（API Gateway）：项目整体对外暴露的接入层；
- 控制模块（Controller）：项目核心业务处理模块，主要包括以下若干子模块：
  - 元信息模块（Meta Module）：用来管理所有基础信息，包括不限于函数基础信息（函数名、创建时间、内存分配、运行时等）、触发器信息（触发器名称、触发器类型等）等，将与存储模块进行直接交互；
  - 触发器模块（Trigger Module）：由于 PyFaaS 是 FaaS 项目，所以依旧是由事件触发为核心的项目，此处的触发器是用来接收和处理事件的部分，将与开放生态做深度融合；
  - 任务/请求模块（Task Module）：用来管理请求和任务的模块；
  - 弹性模块（Scaling Module）：根据请求等相关数据，进行弹性伸缩决策的模块；
  - 运行时模块（Runtime Plugin）：用来管理运行时部分；
  - 权限模块（Auth Module）：包括用户管理与用户权限管理；
- 触发模块（Invoke）：用来分配任务的模块
  - 同步触发：经由控制模块将会直接对执行模块进行相关操作，并等待结果返回，并将结果返回到客户端；
  - 异步触发：经由控制模块后，直接将任务 ID 返回客户端，并将任务传递到异步模块（核心实现方案为 Kafka），经消息中间件进行排队处理后，交予执行模块执行，并将结果存储到存储模块；
- 执行模块（Work）：主要包括调度以及适配两个部分：
  - 调度：如果执行模块对接了虚机或物理机等，那么执行模块要肩负起调度策略，任务下发到不同机器的方案和策略由当前模块实现；
  - 适配：所谓适配指的是当执行模块后对接了其他 FaaS 平台（例如阿里云函数计算、华为云函数计算工作流，AWS Lambda等），该模块要做好代码与对应平台的适配逻辑；
- 存储与可观测模块（Storage & Observability）：主要包括数据库与对象存储等部分以及用户采集、上报和展示相关数据指标；

## 角色与流程

PyFaaS 系统本身包括三个角色：

![image-20221006214344714](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006214344714.png)

如上图所示：

1. PyFaaS 用户（英文表达：PyFaaS User 或 System Administrator），指的是 PyFaaS 搭建者。例如，小明通过 PyFaaS 开源项目，自己搭建了私有化 FaaS 平台，那么小明就是所谓的 PyFaaS 用户；
2. 模块开发者（英文表示：Module Developer），指的是模块的开发者。例如，小明发现 PyFaaS 默认的 Scaling 模块算法过于单一，在其私有化的 FaaS 平台中表现并不是非常好，所以小明根据规范，自己开发了一个 Scaling 模块，此时小明就是所谓的 PyFaaS 用户；
3. 普通用户/使用者（英文表示：User），指的是外部用户。例如，小明通过 PyFaaS 开源项目，自己搭建了私有化 FaaS 平台，并在平台中创建了一个 Web 应用，此时小红等人通过互联网访问了该 Web 应用，此时小红就是所谓的普通用户或使用者；

针对这三个角色，所具备的能力，可以用下表表示：

| 角色            | 能力                                                         |
| --------------- | ------------------------------------------------------------ |
| PyFaaS 用户     | 创建函数、更新函数、删除函数、查看函数、触发函数<br />查询模块、安装模块、卸载模块<br />配置函数策略、配置弹性策略、配置可观测策略、配置触发器策略、配置权限策略、配置运行时策略 |
| 模块开发者      | 创建模块、更新模块、删除模块、查询模块                       |
| 普通用户/使用者 | 触发函数                                                     |

### PyFaaS 用户

![image-20221006215012648](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006215012648.png)



![image-20221006215658516](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006215658516.png)

### 模块开发者

![image-20221006215806310](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006215806310.png)

### 普通用户/使用者

![image-20221006214721255](/Users/anycodes/Library/Application Support/typora-user-images/image-20221006214721255.png)











在上述模块中，可以进行自定义的主要包括：

| 可自定义逻辑               | 可自定义功能/配置            | 不可自定义              |
| -------------------------- | ---------------------------- | ----------------------- |
| 弹性模块（Scaling Module） | 元信息模块（Meta Module）    | 网关模块（API Gateway） |
| 执行模块（Work）           | 触发器模块（Trigger Module） | 触发模块（Invoke）      |
|                            | 运行时模块（Runtime Plugin） |                         |
|                            | 权限模块（Auth Module）      |                         |
|                            | 任务/请求模块（Task Module） |                         |

> 关于`可自定义逻辑`，`可自定义功能/配置`与`不可自定义`的解释如下：
>
> - 可自定义逻辑：
> - 可自定义功能/配置：
> - 不可自定义：